<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>買取表</title>
  <link rel="icon" href="data:,">
  
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

  <style>
    /* ★★★ デザイン設定エリア ★★★ */
    :root {
      --accent: #58BDD7; 
      --accent-hover: #4aaec7;
      --price-color: #ffffff;
      --bg-dark: #121212;
      --card-bg: #1e1e1e;
      --text-main: #ffffff;
      --border: #555555;
      --glow-text: 0 0 8px rgba(88, 189, 215, 0.6);
      --glow-price: 0 0 10px rgba(255, 255, 255, 0.7); 
      --glow-box: 0 0 12px rgba(88, 189, 215, 0.4);
    }

    /* 郵送買取モードのカラースキーム（薄紫） */
    body.mail-mode {
      --accent: #b472ff; 
      --accent-hover: #9e5be0;
      --glow-text: 0 0 8px rgba(180, 114, 255, 0.6);
      --glow-price: 0 0 10px rgba(255, 255, 255, 0.7); 
      --glow-box: 0 0 12px rgba(180, 114, 255, 0.4);
    }

    body { 
      font-family: "Helvetica Neue", Arial, sans-serif; 
      margin: 0; padding: 0; 
      color: var(--text-main);
      background-color: var(--bg-dark);
      background-image: url('./bg-gray.jpg.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      padding-bottom: 80px; /* カートバー用の余白 */
      transition: all 0.5s ease;
    }
    
    body::before {
      content: "";
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.7); 
      z-index: -1;
    }

    * { box-sizing: border-box; }

    /* ★★★ ヘッダー (全画面共通) ★★★ */
    header { 
      background: #111; 
      border-bottom: 2px solid var(--accent); 
      padding: 0 15px; 
      position: relative;
      z-index: 100;
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      height: 60px;
      transition: border-bottom 0.5s ease;
    }
    
    .header-left { display: flex; align-items: center; gap: 15px; z-index: 102; position: relative; }
    .hamburger {
      width: 24px; height: 18px; cursor: pointer;
      display: flex; flex-direction: column; justify-content: space-between;
    }
    .hamburger span {
      display: block; height: 2px; width: 100%; background: var(--text-main); border-radius: 2px; transition: 0.3s;
    }

    .header-center {
      position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
      width: 100%; text-align: center; z-index: 101; pointer-events: none;
    }
    .title-text {
      font-size: 20px; font-weight: 800; color: var(--accent); text-shadow: var(--glow-text);
      font-style: italic; letter-spacing: 1px; white-space: nowrap; transition: color 0.5s;
    }

    .header-right { display: flex; align-items: center; gap: 15px; z-index: 102; position: relative; }
    .logo-img { height: 40px; width: auto; object-fit: contain; filter: none; }
    
    .header-cart-btn {
      display: none; position: relative; font-size: 20px; color: #fff; cursor: pointer;
    }
    body.mail-mode .header-cart-btn { display: block; }
    .cart-badge {
      position: absolute; top: -8px; right: -10px; 
      background: #ff5252; color: #fff; font-size: 10px; font-weight: bold;
      width: 18px; height: 18px; border-radius: 50%; 
      display: flex; align-items: center; justify-content: center;
      border: 1px solid #fff;
    }

    #date-display {
      position: absolute; top: 100%; right: 10px; margin-top: 5px;
      font-size: 10px; color: #aaa; font-weight: bold;
      transition: all 0.5s;
    }

    /* ドロワーメニュー */
    .drawer {
      position: fixed; top: 0; left: -280px; width: 260px; height: 100%;
      background: #1a1a1a; z-index: 99999; transition: left 0.3s ease;
      box-shadow: 2px 0 15px rgba(0,0,0,0.8); display: flex; flex-direction: column;
    }
    .drawer.open { left: 0; }
    .drawer-header {
      padding: 20px; font-size: 18px; font-weight: bold; color: var(--accent);
      border-bottom: 1px solid #333; background: #111; text-shadow: var(--glow-text);
    }
    .drawer-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; }
    .drawer-item {
      padding: 15px 20px; border-bottom: 1px solid #2a2a2a; cursor: pointer; color: #eee; font-weight: bold; font-size:15px;
    }
    .drawer-item:hover { background: #2a2a2a; color: var(--accent); }
    .drawer-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7); backdrop-filter: blur(2px); z-index: 99998;
      display: none; opacity: 0; transition: opacity 0.3s ease;
    }
    .drawer-overlay.open { display: block; opacity: 1; }

    /* ★★★ スライダーバナー ★★★ */
    .slider-container {
      width: 100%; max-width: 1000px; margin: 0 auto;
      position: relative; overflow: hidden; display: none; background: #000;
      border-bottom: 1px solid #333;
    }
    body.mail-mode .slider-container { display: block; }
    .slider-wrapper { display: flex; transition: transform 0.5s ease-in-out; }
    .slider-slide { min-width: 100%; box-sizing: border-box; }
    .slider-slide img { width: 100%; height: auto; display: block; max-height: 250px; object-fit: cover; }
    .slider-dots {
      position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px;
    }
    .slider-dot {
      width: 8px; height: 8px; background: rgba(255,255,255,0.5); border-radius: 50%; cursor: pointer;
    }
    .slider-dot.active { background: #fff; transform: scale(1.2); box-shadow: 0 0 5px #fff; }

    /* ナビゲーション */
    .sticky-container {
      position: sticky; top: 0; z-index: 9990;
      background: rgba(18, 18, 18, 0.95); backdrop-filter: blur(5px);
      border-bottom: 1px solid #444; box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }
    .nav-scroll { overflow-x: auto; white-space: nowrap; padding: 0 10px; border-bottom: 1px solid #333; }
    .nav-tabs { display: flex; gap: 10px; max-width: 1000px; margin: 0 auto; padding: 0; list-style: none; align-items: center; }
    .nav-item { cursor: pointer; padding: 14px 12px; font-weight: bold; color: #888; border-bottom: 3px solid transparent; transition: 0.3s; font-size: 14px; }
    .nav-item:hover { color: #fff; text-shadow: 0 0 5px #fff; }
    .nav-item.active { color: var(--accent); border-bottom-color: var(--accent); text-shadow: var(--glow-text); }

    /* フィルタエリア */
    .filters { 
      max-width: 1000px; margin: 0 auto; padding: 10px 12px; 
      display: flex; gap: 8px; flex-wrap: wrap; align-items: center;
    }
    .search-box { flex: 1; min-width: 120px; position: relative; }
    .search-box input { 
      width: 100%; padding: 8px 8px 8px 30px; border: 1px solid #555; border-radius: 4px; 
      outline: none; font-size: 13px; background: rgba(30, 30, 30, 0.8); color: #fff;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    .search-box input:focus { border-color: var(--accent); box-shadow: 0 0 5px var(--accent); }
    .search-icon { position: absolute; left: 8px; top: 9px; color: #aaa; font-size: 12px; }
    
    select, button { 
      padding: 8px; border: 1px solid #555; border-radius: 4px; 
      background: rgba(30, 30, 30, 0.8); color: #fff; cursor: pointer; font-size: 12px; 
    }
    button { 
      background: var(--accent); border: none; font-weight: bold; transition: 0.3s; box-shadow: var(--glow-text); 
    }
    button:hover { opacity: 0.8; }
    #reload { margin-left: 5px; }

    /* 「買取の流れ」ボタン（郵送モード用） */
    .flow-btn {
      background: transparent; border: 1px solid var(--accent); color: var(--accent);
      display: none; align-items: center; gap: 5px; box-shadow: none;
    }
    .flow-btn:hover { background: rgba(180, 114, 255, 0.1); }
    body.mail-mode .flow-btn { display: flex; }

    /* 「買取終了も表示」ラベル */
    #showSoldOutLabel { display: flex; align-items: center; font-size: 12px; color: #fff; margin-left: auto; cursor: pointer; gap: 6px; }
    body.mail-mode #showSoldOutLabel { display: none; } /* 郵送モードでは非表示 */

    /* ★★★ カードリスト ★★★ */
    .container { max-width: 1000px; margin: 20px auto 0; padding: 0 12px 20px; flex: 1; width: 100%; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px; }
    
    .card { 
      background: var(--card-bg); border-radius: 8px; overflow: hidden; 
      border: 1px solid var(--border); box-shadow: 0 4px 6px rgba(0,0,0,0.6);
      display: flex; flex-direction: column; position: relative; transition: all 0.2s ease;
    }
    /* 店頭モードのみhoverで浮く */
    body:not(.mail-mode) .card:hover { transform: translateY(-4px); border-color: var(--accent); box-shadow: var(--glow-box); }

    /* 店頭モードのSoldOutは薄くする */
    .card.sold-out { border-color: #333; box-shadow: none; }
    .card.sold-out:hover { transform: none; border-color: #333; }

    .card-img { width: 100%; aspect-ratio: 3/4; background: #000; object-fit: contain; border-bottom: 1px solid #333; }
    .no-img { display: flex; align-items: center; justify-content: center; color: #555; font-size: 10px; background: #222; }

    .card-body { padding: 8px; flex: 1; display: flex; flex-direction: column; position: relative; }
    
    /* カードヘッダー */
    .card-header-row {
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;
    }
    .type-label { font-size: 10px; color: var(--accent); font-weight: 900; text-shadow: var(--glow-text); }
    .limit-badge { 
      font-size: 10px; color: #fff; background: #444; padding: 2px 6px; border-radius: 4px; font-weight: bold;
    }
    
    .card-title { 
      font-size: 12px; font-weight: bold; line-height: 1.4; margin-bottom: 6px; color: #fff; 
      display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 34px; 
    }
    
    .card-tags { position: absolute; top: 4px; right: 4px; display: flex; flex-direction: column; gap: 2px; align-items: flex-end; }
    .badge { 
      display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold;
      background: #333; color: #fff; border: 1px solid #555;
    }
    .badge-sotai { background: #555; color: #eee; }

    .card-footer { margin-top: auto; border-top: 1px solid #444; padding-top: 6px; }
    .price-row { display: flex; align-items: baseline; justify-content: space-between; gap: 4px; }
    .price-label { font-size: 9px; color: #aaa; }
    .price-value { color: var(--price-color); font-size: 16px; font-weight: 800; text-shadow: var(--glow-price); }

    /* カートUI */
    .cart-actions {
      display: none; margin-top: 8px; gap: 4px; align-items: center;
    }
    body.mail-mode .cart-actions { display: flex; }
    
    .qty-group {
      display: flex; align-items: center; border: 1px solid #555; border-radius: 4px; background: #fff; height: 28px; overflow: hidden;
    }
    .qty-btn {
      width: 24px; height: 100%; background: #eee; border: none; color: #333; font-weight: bold; padding: 0; 
      display:flex; align-items:center; justify-content:center;
    }
    .qty-input {
      width: 24px; height: 100%; border: none; text-align: center; font-size: 12px; color: #333; font-weight: bold; padding: 0; background: #fff;
    }
    .add-btn {
      flex: 1; height: 28px; font-size: 11px; background: var(--accent); color: #fff; border-radius: 4px; border:none; cursor: pointer;
    }
    .add-btn:active { transform: scale(0.95); }

    /* 郵送モード：買取終了時の表示 */
    .mail-sold-out-block {
      background: #333;
      color: #ff5252;
      font-weight: bold;
      font-size: 13px;
      text-align: center;
      padding: 6px;
      border-radius: 4px;
      margin-top: 8px;
      border: 1px solid #ff5252;
      box-shadow: 0 0 5px rgba(255, 82, 82, 0.4);
    }

    /* 店頭モード：買取終了オーバーレイ */
    .sold-out-overlay {
      position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:50; 
      display:flex; align-items:center; justify-content:center;
    }
    .sold-out-badge {
      background: var(--accent); color: #fff; font-weight: 900; font-size: 12px; padding: 6px 12px; border-radius: 4px; border: 2px solid #fff;
      box-shadow: var(--glow-box);
    }

    /* カート固定バー */
    .cart-bar {
      position: fixed; bottom: 0; left: 0; width: 100%;
      background: #1a1a1a; border-top: 2px solid var(--accent);
      padding: 15px; z-index: 20000;
      display: flex; justify-content: space-between; align-items: center;
      transform: translateY(100%); transition: transform 0.3s ease;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.5);
    }
    .cart-bar.visible { transform: translateY(0); }
    .cart-total-info { font-size: 14px; font-weight: bold; color: #fff; }
    .cart-total-price { font-size: 20px; color: var(--accent); margin-right: 10px; font-weight: bold; text-shadow: var(--glow-text); }
    .check-cart-btn {
      padding: 10px 20px; background: var(--accent); color: #fff; font-weight: bold; border-radius: 4px; border:none; cursor: pointer;
    }

    /* カート確認画面 */
    #cartView {
      display: none; padding: 20px; max-width: 800px; margin: 0 auto; color: #fff;
    }
    .cart-header { font-size: 20px; font-weight: bold; border-bottom: 1px solid #444; padding-bottom: 10px; margin-bottom: 20px; }
    .cart-item {
      display: flex; gap: 15px; padding: 15px 0; border-bottom: 1px solid #333; align-items: flex-start;
    }
    .cart-item-img { width: 60px; height: 80px; background: #000; object-fit: contain; border: 1px solid #444; }
    .cart-item-info { flex: 1; }
    .cart-item-title { font-size: 14px; font-weight: bold; margin-bottom: 5px; }
    .cart-item-meta { font-size: 12px; color: #aaa; margin-bottom: 5px; }
    .cart-item-price { font-size: 16px; color: var(--accent); font-weight: bold; }
    .cart-item-actions { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
    .delete-btn { background: #ff5252; color: #fff; padding: 5px 10px; font-size: 11px; border-radius: 4px; border: none; cursor: pointer; }

    /* 情報ビュー */
    #infoView { display: none; padding: 20px; max-width: 800px; margin: 0 auto; color: #ddd; line-height: 1.8; font-size: 14px; text-align: left; }
    #infoView h2 { color: var(--accent); border-bottom: 1px solid var(--accent); padding-bottom: 10px; margin-top: 30px; }
    #infoView h3 { color: #fff; margin-top: 25px; font-size: 16px; }
    .flow-step { background: #252525; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid var(--accent); }
    .flow-title { font-size: 16px; font-weight: bold; color: var(--accent); margin-bottom: 10px; }
    .note-box { background: rgba(255, 50, 50, 0.1); border: 1px solid #ff5252; padding: 15px; border-radius: 8px; margin-top: 30px; }
    .note-title { color: #ff5252; font-weight: bold; margin-bottom: 10px; font-size: 16px; }
    .faq-q { color: var(--accent); font-weight: bold; }
    .faq-a { margin-left: 10px; margin-bottom: 20px; }

    /* メッセージ・ローディング */
    .closed-message-container {
      grid-column: 1 / -1; text-align: center; padding: 60px 20px; margin-top: 40px;
      border: 3px solid var(--accent); border-radius: 12px;
      background: rgba(88, 189, 215, 0.1); box-shadow: var(--glow-box); color: #ffffff;
    }
    .closed-title { font-size: 26px; font-weight: 900; color: var(--accent); margin-bottom: 20px; text-shadow: var(--glow-text); }
    .closed-text { font-size: 16px; line-height: 2.0; font-weight: bold; }
    .loading { text-align: center; padding: 40px; color: #aaa; grid-column: 1 / -1; }
    .error { background: #330000; color: #ff8a80; padding: 15px; border: 1px solid #ff5252; margin-bottom: 20px; display: none; }

    /* モーダル */
    .modal-overlay {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.85); z-index: 10000; justify-content: center; align-items: center; 
      padding: 15px; backdrop-filter: blur(4px);
    }
    .modal-overlay.active { display: flex; }
    .modal-content {
      background: #1e1e1e; border: 2px solid var(--accent); border-radius: 12px;
      width: 100%; max-width: 400px; max-height: 90vh; overflow-y: auto;
      position: relative; padding: 20px; box-shadow: 0 0 30px rgba(88, 189, 215, 0.2);
    }
    body.mail-mode .modal-content { box-shadow: 0 0 30px rgba(180, 114, 255, 0.2); }
    .close-modal { position: absolute; top: 10px; right: 15px; font-size: 32px; color: #888; cursor: pointer; }
    .modal-img-wrapper { text-align: center; margin-bottom: 15px; background:#000; padding:10px; border-radius:8px;}
    .modal-img { max-height: 300px; max-width: 100%; object-fit: contain; }
    .modal-title { font-size: 18px; font-weight: bold; color: #fff; margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 15px; }
    .modal-row { display: flex; justify-content: space-between; align-items: baseline; margin-top:10px;}
    .modal-price { font-size: 32px; color: #ffffff; font-weight: 900; text-shadow: var(--glow-price); }
    .modal-label { font-size: 12px; color: #aaa; }

    /* ページネーション */
    .pagination {
      display: flex; justify-content: center; align-items: center; gap: 15px;
      margin-top: 40px; padding-top: 20px; border-top: 1px solid #333;
    }
    .page-btn {
      padding: 8px 16px; background: #333; border: 1px solid #555;
      color: #fff; border-radius: 4px; cursor: pointer; font-size: 14px; transition: all 0.2s;
    }
    .page-btn:hover:not(:disabled) {
      background: var(--accent); border-color: var(--accent); box-shadow: var(--glow-text);
    }
    .page-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .page-info { font-size: 14px; font-weight: bold; color: #aaa; }

    footer { background: #0f0f0f; border-top: 1px solid #333; padding: 20px; text-align: center; margin-top: auto; position: relative; }
    .footer-links { display: flex; justify-content: center; gap: 20px; margin-bottom: 10px; }
    .footer-link { color: #888; font-size: 12px; text-decoration: none; cursor: pointer; }
    .footer-version { position: absolute; bottom: 5px; left: 10px; font-size: 9px; color: #444; }

    /* ★★★ スマホ調整 (バランス調整) ★★★ */
    @media (max-width: 600px) {
      .grid { grid-template-columns: repeat(3, 1fr); gap: 8px; } /* スマホ3列 */
      .card-title { font-size: 10px; height: 28px; }
      .price-value { font-size: 14px; }
      
      /* カートボタンの段落ち防止 */
      .cart-actions { flex-direction: column; align-items: stretch; }
      .qty-group { margin-bottom: 4px; }

      /* ★ フィルタエリアのレイアウト修正 (Flexboxに戻す) */
      .filters {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
      }
      
      /* 検索ボックスは横いっぱいに */
      .search-box { width: 100%; order: 1; }
      
      /* 買取の流れボタンは検索ボックスの横...ではなく、スペース的に厳しいので検索の下に配置 */
      /* ご要望：検索バーの横に買取の流れが来るようにして -> 横並びにする */
      .search-box { width: calc(100% - 110px); order: 1; } /* 検索バーを少し縮める */
      .flow-btn { width: 100px; order: 2; padding: 8px 4px; font-size: 11px; justify-content: center; } /* 横に配置 */
      
      /* 2段目: ソート + 終了表示 */
      #sort { flex: 1; order: 3; width: auto; } /* 自然な幅に戻す */
      #showSoldOutLabel { order: 4; margin-left: 0; white-space: nowrap; }

      /* 更新ボタン非表示 */
      #reload { display: none; }
    }
  </style>
</head>
<body>

  <header>
    <div class="header-left">
      <div class="hamburger" id="hamburgerBtn"><span></span><span></span><span></span></div>
    </div>
    <div class="header-center">
      <div class="title-text" id="mainTitle">店頭買取表</div>
    </div>
    <div class="header-right">
      <div class="header-cart-btn" onclick="openCart()">
        <i class="fa-solid fa-cart-shopping"></i>
        <span class="cart-badge" id="headerCartCount">0</span>
      </div>
      <img src="./logo.png.png.png.png" alt="ロゴ" class="logo-img" />
    </div>
  </header>

  <div id="drawerOverlay" class="drawer-overlay"></div>
  <div id="drawerMenu" class="drawer">
    <div class="drawer-header">MENU</div>
    <ul class="drawer-list">
      <li class="drawer-item" id="menuStore">店頭買取表</li>
      <li class="drawer-item" id="menuMail">郵送買取表</li>
      <li class="drawer-item" onclick="openInfo('privacy')">プライバシーポリシー</li>
      <li class="drawer-item" onclick="openInfo('terms')">利用規約</li>
    </ul>
  </div>

  <div id="mainView">
    <div id="date-display"></div>

    <div class="slider-container" id="bannerSlider">
      <div class="slider-wrapper" id="sliderWrapper"></div>
      <div class="slider-dots" id="sliderDots"></div>
    </div>

    <div class="sticky-container">
      <div class="nav-scroll">
        <ul class="nav-tabs" id="categoryTabs">
          <li class="nav-item active" data-cat="ポケモン">ポケモン</li>
          <li class="nav-item" data-cat="ワンピース">ワンピース</li>
          <li class="nav-item" data-cat="ドラゴンボール">ドラゴンボール</li>
          <li class="nav-item" data-cat="遊戯王">遊戯王</li>
          <li class="nav-item" data-cat="ヴァイス">ヴァイス</li>
          <li class="nav-item" data-cat="その他">その他</li>
        </ul>
      </div>
      <div class="filters">
        <div class="search-box"><span class="search-icon">🔍</span><input id="q" placeholder="検索" /></div>
        <button id="flowBtn" class="flow-btn" onclick="openInfo('flow')"><i class="fa-solid fa-book-open"></i> 買取の流れ</button>
        
        <select id="sort">
          <option value="price_desc">高い順</option>
          <option value="price_asc">安い順</option>
          <option value="type_psa10">PSA10</option>
          <option value="type_mikaifu">未開封</option> 
          <option value="type_sotai">素体</option>
          <option value="type_box">BOX</option>
        </select>
        
        <label id="showSoldOutLabel">
          <input type="checkbox" id="showSoldOut" checked> 終了も表示
        </label>
        
        <button id="reload">更新</button>
      </div>
    </div>

    <div class="container">
      <div id="err" class="error"></div>
      <div id="grid" class="grid"></div>
      <div id="paginationCtrl" class="pagination" style="display:none;">
        <button id="prevBtn" class="page-btn">前へ</button><span id="pageInfo" class="page-info">1/1</span><button id="nextBtn" class="page-btn">次へ</button>
      </div>
    </div>
  </div>

  <div id="cartView">
    <div class="back-btn-container" style="text-align:left;">
      <button onclick="closeCart()" style="padding:5px 15px;">＜ 戻る</button>
    </div>
    <div class="cart-header">カートを編集</div>
    <div id="cartItemsList"></div>
    <div style="text-align:right; margin-top:20px; font-size:18px; font-weight:bold;">
      合計 <span style="color:var(--accent); font-size:24px;" id="cartViewTotal">¥0</span>
    </div>
  </div>

  <div id="cartBar" class="cart-bar">
    <div class="cart-total-info">
      合計 <span class="cart-total-price" id="cartTotalPrice">¥0</span>
      <span id="cartTotalCount">(0点)</span>
    </div>
    <button class="check-cart-btn" onclick="openCart()">カートを確認</button>
  </div>

  <div id="infoView">
    <div class="back-btn-container"><button onclick="closeInfo()" style="padding:10px 30px;">一覧に戻る</button></div>
    <div id="infoContent"></div>
    <div class="back-btn-container" style="margin-top:40px;"><button onclick="closeInfo()" style="padding:10px 30px;">一覧に戻る</button></div>
  </div>

  <div id="modal" class="modal-overlay">
    <div class="modal-content">
      <span class="close-modal" id="closeModalBtn">&times;</span>
      <div class="modal-tags" id="modalTags"></div>
      <div class="modal-img-wrapper"><img id="modalImg" src="" class="modal-img" /></div>
      <div class="modal-title" id="modalTitle"></div>
      <div class="modal-row">
        <span class="modal-label">買取価格</span><span class="modal-price" id="modalPrice"></span>
      </div>
      <div style="text-align:right; margin-top:5px;"><span class="limit" id="modalLimit" style="font-size:14px; padding:4px 10px;"></span></div>
    </div>
  </div>

  <footer>
    <div class="footer-links">
      <a class="footer-link" onclick="openInfo('privacy')">プライバシーポリシー</a><span style="color:#333">|</span><a class="footer-link" onclick="openInfo('terms')">利用規約</a>
    </div>
    <div class="copyright">© 2026 トレカフォース</div>
    <div class="footer-version">v9.1</div>
  </footer>

  <script>
    // ★ GAS URL（必ずご自身のものに書き換えてください）
    const API = "https://script.google.com/macros/s/AKfycbw08oFxfH6FsxcJ77mgNLeticvOFaq2rknNBK3emZgwmhsM5-sB_ltBhbuKamoXHkV8/exec";
    
    // ★ 設定: バナー画像URL（最大5つまで）
    const BANNER_IMAGES = [
      "https://placehold.jp/3d4070/ffffff/1000x250.png?text=郵送買取バナー1",
      "https://placehold.jp/703d40/ffffff/1000x250.png?text=郵送買取バナー2"
    ];

    let ALL_DATA = {}, CURRENT_ITEMS = [], CUR_PAGE = 1, CART = {};
    const ITEMS_per_PAGE = 60;
    const urlParams = new URLSearchParams(window.location.search);
    let currentCategory = urlParams.get('cat') || "ポケモン";
    let isMailMode = urlParams.get('mode') === 'mail';

    const el = (id) => document.getElementById(id);
    const yen = (n) => "¥" + Number(n).toLocaleString();

    function updateDate(d) {
      if(!d) d = new Date();
      const m = (d.getMinutes()<30?"00":"30"); 
      el("date-display").textContent = `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()} ${d.getHours()}:${String(d.getMinutes()).padStart(2,'0')} 更新`;
    }
    updateDate();

    function updateModeUI() {
      if(isMailMode) {
        document.body.classList.add('mail-mode');
        el("mainTitle").textContent = "郵送買取表";
        initSlider(); renderCartBar();
      } else {
        document.body.classList.remove('mail-mode');
        el("mainTitle").textContent = "店頭買取表";
        el("cartBar").classList.remove("visible");
      }
    }

    // スライダー
    function initSlider() {
      if(BANNER_IMAGES.length === 0) { el("bannerSlider").style.display='none'; return; }
      el("sliderWrapper").innerHTML = BANNER_IMAGES.map(s=>`<div class="slider-slide"><img src="${s}"></div>`).join("");
      el("sliderDots").innerHTML = BANNER_IMAGES.map((_,i)=>`<div class="slider-dot ${i===0?'active':''}" onclick="moveSlide(${i})"></div>`).join("");
    }
    let slideIdx = 0;
    function moveSlide(i) {
      slideIdx = i;
      el("sliderWrapper").style.transform = `translateX(-${i*100}%)`;
      document.querySelectorAll(".slider-dot").forEach((d,n)=>d.classList.toggle("active",n===i));
    }
    setInterval(() => { if(isMailMode) moveSlide((slideIdx+1)%BANNER_IMAGES.length); }, 4000);

    // データ取得
    async function loadData() {
      const sheetName = isMailMode ? "郵送"+currentCategory : currentCategory;
      if(ALL_DATA[sheetName]) { render(); return; }
      el("grid").innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:40px;color:#aaa;">読み込み中...</div>';
      try {
        const res = await fetch(`${API}?category=${sheetName}&t=${Date.now()}`);
        const data = await res.json();
        if(data.error) throw new Error(data.error);
        ALL_DATA[sheetName] = data;
        updateDate();
        render();
      } catch(e) {
        el("grid").innerHTML = `<div style="grid-column:1/-1;color:red;text-align:center;">エラー: ${e.message}</div>`;
      }
    }

    function render() {
      const data = ALL_DATA[isMailMode ? "郵送"+currentCategory : currentCategory];
      if(!data || !data.items) return;
      
      let items = data.items.filter(x => {
        const q = el("q").value.toLowerCase();
        return !q || (x.name+x.series).toLowerCase().includes(q);
      });

      if(!isMailMode && !el("showSoldOut").checked) items = items.filter(x => x.remaining > 0);

      const sort = el("sort").value;
      const typePrio = {"PSA10":1,"未開封":2,"素体":3,"BOX":4};
      items.sort((a,b) => {
        const pa = typePrio[a.type]||99, pb = typePrio[b.type]||99;
        if(pa!==pb) return pa-pb;
        return sort==="price_asc" ? a.price-b.price : b.price-a.price;
      });

      CURRENT_ITEMS = items;
      CUR_PAGE = 1;
      renderPage();
    }

    function renderPage() {
      const start = (CUR_PAGE-1)*ITEMS_per_PAGE;
      const pageItems = CURRENT_ITEMS.slice(start, start+ITEMS_per_PAGE);
      
      el("grid").innerHTML = pageItems.map((item, i) => {
        const idx = start + i;
        const isSold = item.remaining <= 0;
        const img = item.imageUrl ? `<img src="${item.imageUrl}" class="card-img" loading="lazy">` : `<div class="card-img no-img">No Image</div>`;
        const badge = (item.type==="素体" && item.grade) ? `<span class="badge-sotai">${item.grade}</span>` : "";
        
        let actions = "";
        if(isMailMode) {
          if(isSold) {
             actions = `<div class="mail-sold-out-block">買取終了</div>`;
          } else {
            const inCart = CART[item.id] || 0; 
            const key = item.id || `temp-${idx}`; 
            actions = `
              <div class="cart-actions">
                <div class="qty-group">
                  <button class="qty-btn" onclick="event.stopPropagation();chQty('${key}', -1)">-</button>
                  <input class="qty-input" id="qty-${key}" value="1" readonly onclick="event.stopPropagation()">
                  <button class="qty-btn" onclick="event.stopPropagation();chQty('${key}', 1, ${item.remaining})">+</button>
                </div>
                <button class="add-btn" onclick="event.stopPropagation();addCart('${key}', ${idx})">追加</button>
              </div>`;
          }
        }

        let overlay = (!isMailMode && isSold) ? `<div class="sold-out-overlay"><div class="sold-out-badge">買取終了</div></div>` : "";

        return `
          <div class="card ${isSold?'sold-out':''}" data-index="${idx}">
            ${overlay}
            <div style="${isSold?'opacity:0.6':''}">
              ${img}
              <div class="card-tags">${badge}</div>
              <div class="card-body">
                <div class="card-header-row">
                  <span class="type-label">【${item.type||"PSA10"}】</span>
                  <span class="limit-badge">残:${item.remaining}</span>
                </div>
                <div class="card-title">${item.name}</div>
                <div class="card-footer">
                  <div class="price-row">
                    <span class="price-label">買取価格</span>
                    <span class="price-value">${yen(item.price)}</span>
                  </div>
                  ${actions}
                </div>
              </div>
            </div>
          </div>`;
      }).join("");

      el("paginationCtrl").style.display = CURRENT_ITEMS.length > ITEMS_per_PAGE ? "flex" : "none";
      el("pageInfo").innerText = `${CUR_PAGE} / ${Math.ceil(CURRENT_ITEMS.length/ITEMS_per_PAGE)}`;
    }

    // カート機能
    function chQty(key, d, max) {
      const inp = el(`qty-${key}`);
      let v = parseInt(inp.value) + d;
      if(v<1) v=1; if(max && v>max) v=max;
      inp.value = v;
    }

    function addCart(key, idx) {
      const item = CURRENT_ITEMS[idx];
      const qty = parseInt(el(`qty-${key}`).value);
      if(!CART[key]) CART[key] = { item: item, qty: 0 };
      if(CART[key].qty + qty > item.remaining) { alert("買取可能枚数を超えております"); return; }
      CART[key].qty += qty;
      renderCartBar();
    }

    function renderCartBar() {
      const keys = Object.keys(CART);
      if(keys.length===0) { 
        el("cartBar").classList.remove("visible"); 
        el("headerCartCount").style.display='none';
        return; 
      }
      let count=0, total=0;
      keys.forEach(k => {
        count += CART[k].qty;
        total += CART[k].item.price * CART[k].qty;
      });
      el("cartTotalPrice").innerText = yen(total);
      el("cartTotalCount").innerText = `(${count}点)`;
      el("cartBar").classList.add("visible");
      el("headerCartCount").innerText = count;
      el("headerCartCount").style.display = 'flex';
    }

    function openCart() {
      el("mainView").style.display = "none";
      el("cartBar").classList.remove("visible");
      el("cartView").style.display = "block";
      window.scrollTo(0,0);

      const list = el("cartItemsList");
      const keys = Object.keys(CART);
      if(keys.length===0) {
        list.innerHTML = "<p style='text-align:center;color:#aaa'>カートは空です</p>";
        el("cartViewTotal").innerText = "¥0";
        return;
      }

      let total = 0;
      list.innerHTML = keys.map(k => {
        const c = CART[k];
        total += c.item.price * c.qty;
        const img = c.item.imageUrl ? `<img src="${c.item.imageUrl}" class="cart-item-img">` : `<div class="cart-item-img"></div>`;
        return `
          <div class="cart-item">
            ${img}
            <div class="cart-item-info">
              <div class="cart-item-title">${c.item.name}</div>
              <div class="cart-item-meta">【${c.item.type}】 単価:${yen(c.item.price)}</div>
              <div class="cart-item-price">小計: ${yen(c.item.price * c.qty)}</div>
              <div class="cart-item-actions">
                <div class="qty-group">
                  <button class="qty-btn" onclick="updateCart('${k}', -1)">-</button>
                  <input class="qty-input" value="${c.qty}" readonly>
                  <button class="qty-btn" onclick="updateCart('${k}', 1, ${c.item.remaining})">+</button>
                </div>
                <button class="delete-btn" onclick="removeCart('${k}')">削除</button>
              </div>
            </div>
          </div>`;
      }).join("");
      el("cartViewTotal").innerText = yen(total);
    }

    function updateCart(key, d, max) {
      CART[key].qty += d;
      if(CART[key].qty < 1) CART[key].qty = 1;
      if(max && CART[key].qty > max) { CART[key].qty = max; alert("買取可能枚数を超えております"); }
      openCart(); renderCartBar();
    }
    function removeCart(key) { delete CART[key]; openCart(); renderCartBar(); }
    function closeCart() { el("cartView").style.display = "none"; el("mainView").style.display = "block"; renderCartBar(); }

    const drawer = el("drawerMenu"); const overlay = el("drawerOverlay");
    function toggleDrawer() { drawer.classList.toggle("open"); overlay.classList.toggle("open"); }
    el("hamburgerBtn").onclick = toggleDrawer; overlay.onclick = toggleDrawer;

    el("menuStore").onclick = () => { isMailMode=false; switchMode(); toggleDrawer(); };
    el("menuMail").onclick = () => { isMailMode=true; switchMode(); toggleDrawer(); };

    function switchMode() {
      const url = new URL(location);
      url.searchParams.set("cat", currentCategory);
      if(isMailMode) url.searchParams.set("mode","mail"); else url.searchParams.delete("mode");
      history.pushState({},"",url);
      updateModeUI(); loadData();
    }

    document.querySelectorAll(".nav-item").forEach(t => {
      t.onclick = (e) => {
        document.querySelectorAll(".nav-item").forEach(x=>x.classList.remove("active"));
        e.target.classList.add("active");
        currentCategory = e.target.dataset.cat;
        switchMode();
      };
    });

    el("sort").onchange = render; el("showSoldOut").onchange = render;
    el("q").oninput = () => setTimeout(render, 300);
    el("reload").onclick = () => { ALL_DATA={}; loadData(); };
    
    // ページロード
    el("prevBtn").onclick = () => { CUR_PAGE--; renderPage(); };
    el("nextBtn").onclick = () => { CUR_PAGE++; renderPage(); };

    // 情報画面
    const contentData = {
      privacy: `
        <h2>プライバシーポリシー</h2>
        <p>株式会社Niutiny（以下「当社」といいます。）は、当社が本ウェブサイト上で提供する各種サービス（以下「本サービス」といいます。）において取得するユーザーの個人情報について、以下のとおりプライバシーポリシー（以下「本ポリシー」といいます。）を定め、適切に取り扱います。</p>
        <h3>第1条（個人情報の定義）</h3>
        <p>本ポリシーにおける「個人情報」とは、個人情報の保護に関する法律（個人情報保護法）に定める「個人情報」を指し、氏名、生年月日、住所、電話番号、連絡先その他の記述等により特定の個人を識別できる情報をいいます。<br>また、容貌、指紋、声紋等のデータ、健康保険証の保険者番号その他の情報単体で個人を識別できる情報（個人識別符号）もこれに含まれます。</p>
        <h3>第2条（個人情報の取得方法）</h3>
        <p>当社は、ユーザーが本サービスの利用登録等を行う際に、メールアドレス等の個人情報の提供を求める場合があります。</p>
        <h3>第3条（利用目的）</h3>
        <p>当社が個人情報を取得・利用する目的は、次のとおりです。</p>
        <ol><li>本サービスの提供および運営のため</li><li>お問い合わせへの対応（本人確認を含みます。）のため</li><li>ユーザーが利用中のサービスに関する新機能、更新、キャンペーン等、ならびに当社が提供する他サービスの案内をメール等で送付するため</li><li>メンテナンス情報や重要なお知らせ等、必要な連絡を行うため</li><li>利用規約に違反するユーザー、または不正・不当な目的で利用しようとするユーザーを特定し、利用をお断りするため</li><li>登録情報の閲覧・変更・削除および利用状況の確認等を行っていただくため</li><li>上記各目的に付随する目的のため</li></ol>
        <h3>第4条（利用目的の変更）</h3>
        <ol><li>当社は、変更後の利用目的が変更前の目的と関連性を有すると合理的に判断できる場合に限り、個人情報の利用目的を変更することがあります。</li><li>利用目的を変更した場合、当社所定の方法によりユーザーへ通知する、または本ウェブサイト上で公表します。</li></ol>
        <h3>第5条（第三者提供）</h3>
        <ol><li>当社は、次の場合を除き、あらかじめユーザーの同意を得ることなく個人情報を第三者に提供しません。なお、個人情報保護法その他法令により認められる場合を除きます。<ol><li>人の生命、身体または財産の保護のために必要で、本人の同意を得ることが困難な場合</li><li>公衆衛生の向上または児童の健全育成の推進のために特に必要で、本人の同意を得ることが困難な場合</li><li>国の機関、地方公共団体またはこれらの委託先が法令に基づく事務を遂行するうえで協力が必要であり、同意取得により事務遂行に支障が生じるおそれがある場合</li><li>事前に次の事項を告知または公表し、かつ当社が個人情報保護委員会へ届出を行った場合<ul><li>利用目的に第三者提供が含まれること</li><li>提供されるデータ項目</li><li>提供手段または方法</li><li>本人の求めにより第三者提供を停止できること</li><li>その申出の受付方法</li></ul></li></ol></li><li>前項にかかわらず、次の各号に該当する場合、提供先は「第三者」に該当しないものとします。<ol><li>利用目的の達成に必要な範囲で、個人情報の取扱いを全部または一部委託する場合</li><li>合併その他の事由による事業承継に伴い個人情報が引き継がれる場合</li><li>個人情報を特定の者と共同利用する場合で、共同利用する情報の項目、共同利用者の範囲、利用目的、および管理責任者の氏名または名称について、あらかじめ本人へ通知するか、または本人が容易に知り得る状態に置いた場合</li></ol></li></ol>
        <h3>第6条（開示）</h3>
        <ol><li>当社は、本人から個人情報の開示を求められた場合、本人に対し遅滞なく開示します。ただし、開示により次のいずれかに該当する場合、全部または一部を開示しないことがあり、その場合は遅滞なく通知します。<ol><li>本人または第三者の生命、身体、財産その他の権利利益を害するおそれがある場合</li><li>当社の業務の適正な実施に著しい支障を及ぼすおそれがある場合</li><li>その他法令に違反することとなる場合</li></ol></li><li>履歴情報・特性情報等、個人情報に該当しない情報については、原則として開示しません。</li></ol>
        <h3>第7条（訂正・追加・削除）</h3>
        <ol><li>ユーザーは、当社が保有する自己の個人情報が事実と異なる場合、当社所定の手続により、訂正、追加または削除（以下「訂正等」といいます。）を請求できます。</li><li>当社は、請求内容を確認し、対応が必要と判断した場合、遅滞なく訂正等を行います。</li><li>当社は、訂正等を行った場合、または行わない旨を決定した場合、遅滞なくユーザーへ通知します。</li></ol>
        <h3>第8条（利用停止・消去）</h3>
        <ol><li>当社は、本人から「利用目的の範囲を超えた取扱い」または「不正な手段による取得」を理由として、利用停止または消去（以下「利用停止等」といいます。）の申出があった場合、必要な調査を速やかに行います。</li><li>調査の結果、対応が必要と判断した場合、遅滞なく利用停止等を実施します。</li><li>当社は、利用停止等を行った場合、または行わない旨を決定した場合、遅滞なく通知します。</li><li>利用停止等に多額の費用を要する場合など、実施が困難であっても、ユーザーの権利利益を保護するために必要な代替措置が可能な場合は、当該代替措置を講じます。</li></ol>
        <h3>第9条（本ポリシーの改定）</h3>
        <ol><li>当社は、法令その他本ポリシーに別段の定めがある事項を除き、ユーザーへ事前通知することなく本ポリシーを変更できるものとします。</li><li>変更後の本ポリシーは、当社ウェブサイトに掲載した時点から効力を生じます（当社が別途定める場合を除きます）。</li></ol>
        <h3>第10条（お問い合わせ窓口）</h3>
        <p>本ポリシーに関するご質問・ご相談は、以下までご連絡ください。<br>社名：株式会社Niutiny<br>Eメール：tttcgforce [@] gmail.com</p>
      `,
      terms: `
        <h2>利用規約</h2>
        <p>この利用規約（以下「本規約」といいます。）は、株式会社Niutiny（以下「当社」といいます。）が運営するウェブサイトおよび実店舗等を通じて提供するサービス（以下「本サービス」といいます。）の利用条件を定めるものです。登録ユーザー（以下「ユーザー」といいます。）は、本規約に同意のうえ、本サービスを利用するものとします。</p>
        <h3>第1条（適用）</h3>
        <ol><li>本規約は、本サービスの利用に関し、ユーザーと当社との間の一切の関係に適用されます。</li><li>当社は、本規約のほか、本サービスの利用に関するルール、ガイドライン、注意事項等（以下「個別規定」といいます。）を定めることがあります。個別規定は名称のいかんを問わず本規約の一部を構成します。</li><li>本規約と個別規定が抵触する場合、個別規定に特段の定めがない限り、個別規定が優先します。</li></ol>
        <h3>第2条（定義）</h3>
        <p>本規約において、次の用語は以下の意味で使用します。</p>
        <ol><li>「本サービス」：当社ウェブサイト、当社が運営する実店舗（屋号を含みます。例：トレカフォース）その他当社が指定する媒体で提供する、商品販売、買取、査定、情報提供、会員機能等の総称</li><li>「商品」：当社が販売または買取対象とするトレーディングカード、関連商品、周辺機器等</li><li>「買取」：ユーザーが当社に対し商品を売却する取引（店頭・宅配等の方式を含みます。）</li></ol>
        <h3>第3条（利用登録）</h3>
        <ol><li>利用登録を希望する者は、本規約に同意のうえ、当社所定の方法で申請し、当社が承認した時点で利用登録が完了します。</li><li>当社は、申請者に以下の事由があると判断した場合、申請を承認しないことがあり、その理由の開示義務を負いません。<ol><li>申請内容に虚偽、誤記、記入漏れがある場合</li><li>過去に本規約等に違反した者からの申請である場合</li><li>その他、当社が登録を相当でないと判断した場合</li></ol></li></ol>
        <h3>第4条（ユーザーID・パスワードの管理）</h3>
        <ol><li>ユーザーは、自己の責任でユーザーIDおよびパスワードを適切に管理するものとします。</li><li>ユーザーは、ユーザーID・パスワードを第三者に譲渡、貸与、共有してはなりません。</li><li>当社は、登録情報と一致するユーザーID・パスワードでログインが行われた場合、当該ユーザー本人による利用とみなします。</li><li>第三者による不正使用により損害が生じても、当社に故意または重大な過失がある場合を除き、当社は責任を負いません。</li></ol>
        <h3>第5条（利用料金・商品代金等）</h3>
        <ol><li>本サービスの閲覧・情報利用等（当社が別途有料と定めるものを除きます。）は原則無料とします。</li><li>ユーザーが当社から商品を購入する場合、ユーザーは当社が別途表示する商品代金、送料、決済手数料その他費用を支払うものとします。</li><li>ユーザーが当社に商品を売却する場合（買取）、当社は当社所定の査定基準に基づき買取価格を提示し、買取が成立したときに当社所定の方法で代金を支払います。</li><li>本規約に定めのない支払方法・条件は、当社が別途定める表示または個別規定に従うものとします。</li></ol>
        <h3>第6条（売買契約の成立・変更・キャンセル）</h3>
        <ol><li>ユーザーが商品購入を申し込み、当社が当該申込みを承諾した時点で、当社とユーザー間の売買契約が成立します（承諾の方法は当社所定とします）。</li><li>当社は、在庫状況、表示の誤り、システム障害、その他合理的な理由がある場合、申込みを承諾しないこと、または承諾後であっても取消しを行うことがあります。</li><li>商品価格、在庫、仕様、掲載内容は予告なく変更されることがあります。</li><li>売買契約成立後のキャンセル、変更、返品は、当社が別途定める条件（第12条を含みます。）に従うものとします。</li></ol>
        <h3>第7条（買取に関する特則）</h3>
        <ol><li>買取は、当社が提示する買取条件（買取価格、対象、状態基準、本人確認等）にユーザーが同意し、当社が買取を承諾した時点で成立します。</li><li>当社は、商品の状態、真贋、相場変動、在庫状況、申告内容の相違等により、査定額の変更、買取の拒否、または取引の中止を行うことがあります。</li><li>査定は当社所定の基準で行い、傷・欠け・反り・日焼け・湿気痕・臭気・改造・欠品等がある場合は減額または買取不可となる場合があります。</li><li>買取成立後は、法令上許される場合を除き、ユーザー都合によるキャンセル・返品・返金はできません。</li><li>買取代金の支払方法（現金、振込等）、支払時期、手数料負担の有無は当社所定とします。</li></ol>
        <h3>第8条（本人確認・年齢等）</h3>
        <ol><li>当社は、販売・買取その他取引に際し、法令（古物営業法等）または当社方針に基づき、本人確認書類の提示、情報の記録・保管を求める場合があります。ユーザーはこれに協力するものとします。</li><li>未成年者が本サービスにより取引を行う場合、当社は親権者等の同意・同伴・同意書提出等を求め、または取引をお断りすることがあります。</li><li>本人確認・年齢確認ができない場合、または当社が不適切と判断した場合、当社は取引を拒否または中止できます。</li><li>当社の古物商許可に関する表示は、店頭または当社が指定する方法で掲示します。</li></ol>
        <h3>第9条（禁止事項）</h3>
        <p>ユーザーは、本サービスの利用にあたり、以下の行為をしてはなりません。</p>
        <ol><li>法令または公序良俗に反する行為</li><li>犯罪行為に関連する行為、またはこれを助長する行為</li><li>当社または第三者の知的財産権（著作権、商標権等）を侵害する行為</li><li>当社または第三者のサーバー・ネットワークの機能を破壊・妨害する行為</li><li>当社の許諾なく、本サービスで得た情報を商業利用する行為</li><li>本サービスの運営を妨げるおそれのある行為</li><li>不正アクセスまたはその試行</li><li>他ユーザーの個人情報等を収集・蓄積する行為</li><li>不正・不当な目的で本サービスを利用する行為</li><li>他者に不利益、損害、不快感を与える行為</li><li>なりすまし行為</li><li>当社が許諾しない広告・宣伝・勧誘・営業行為</li><li>盗品、偽造品、模造品、権利侵害品、出所不明品等を販売・買取に持ち込む、またはその疑いがある行為</li><li>反社会的勢力への利益供与（直接・間接を問わず）</li><li>その他、当社が不適切と判断する行為</li></ol>
        <h3>第10条（本サービスの停止・中断）</h3>
        <ol><li>当社は、以下の場合、事前通知なく本サービスの全部または一部を停止・中断できます。<ol><li>システム保守点検・更新を行う場合</li><li>天災地変、停電、火災、通信障害等の不可抗力により提供が困難な場合</li><li>その他、当社が停止・中断が必要と判断した場合</li></ol></li><li>当社は、停止・中断により生じた不利益・損害について責任を負いません。</li></ol>
        <h3>第11条（利用制限・登録抹消）</h3>
        <ol><li>当社は、ユーザーが次のいずれかに該当する場合、事前通知なく利用制限または登録抹消等の措置を講じることができます。<ol><li>本規約に違反した場合</li><li>登録事項に虚偽が判明した場合</li><li>取引上の支払債務がある場合に履行されない場合</li><li>当社からの連絡に一定期間応答がない場合</li><li>一定期間利用がない場合</li><li>その他、当社が不適当と判断した場合</li></ol></li><li>当社は本条に基づく措置により生じた損害について責任を負いません。</li></ol>
        <h3>第12条（返品・返金・交換）</h3>
        <ol><li>商品の性質上、ユーザー都合による返品・交換は原則として受け付けません（当社が別途認める場合を除きます）。</li><li>初期不良、誤配送等当社責に帰すべき事由がある場合、当社所定の期間・手続により、返品・交換または返金に応じます。</li><li>買取成立後の返品・返金は、法令上許される場合を除き行いません。</li></ol>
        <h3>第13条（保証の否認・免責）</h3>
        <ol><li>当社は、本サービスに瑕疵（安全性、正確性、完全性、特定目的適合性、セキュリティ上の欠陥、エラー、バグ、権利侵害等を含みます。）がないことを保証しません。</li><li>当社は、本サービスに起因してユーザーに生じた損害について、当社の故意または重過失による場合を除き責任を負いません。</li><li>消費者契約法が適用される場合、前項の免責が制限されることがあります。</li><li>当社は、ユーザーと第三者間の取引・連絡・紛争等について関与せず責任を負いません。</li></ol>
        <h3>第14条（サービス内容の変更・終了）</h3>
        <p>当社は、ユーザーへの事前通知なく、本サービスの内容、提供条件等を変更し、または本サービスを停止・終了することがあります。これによりユーザーに不利益・損害が生じても、当社は責任を負いません。</p>
        <h3>第15条（規約の変更）</h3>
        <ol><li>当社は、(1)変更がユーザー一般の利益に適合する場合、または(2)変更が契約目的に反せず合理的である場合、ユーザーの個別同意なく本規約を変更できるものとします。</li><li>当社は、変更する場合、変更後の内容および効力発生日を、当社所定の方法で事前に通知または公表します。</li></ol>
        <h3>第16条（個人情報の取扱い）</h3>
        <p>当社は、本サービスにより取得する個人情報を、別途定めるプライバシーポリシーに従い取り扱います。</p>
        <h3>第17条（通知・連絡）</h3>
        <ol><li>ユーザーと当社間の通知・連絡は当社所定の方法で行います。</li><li>当社は、登録された連絡先に通知・連絡を行い、発信時に到達したものとみなします（変更届出がない場合）。</li></ol>
        <h3>第18条（権利義務の譲渡禁止）</h3>
        <p>ユーザーは、当社の書面による事前承諾なく、利用契約上の地位または本規約に基づく権利義務を第三者に譲渡し、または担保に供することはできません。</p>
        <h3>第19条（準拠法・管轄）</h3>
        <ol><li>本規約は日本法に準拠します。</li><li>本サービスに関して紛争が生じた場合、当社本店所在地を管轄する裁判所を第一審の専属的合意管轄裁判所とします。</li></ol>
      `,
      flow: `
        <h2>郵送買取の流れ</h2>
        <div class="flow-step"><div class="flow-title">STEP 1｜商品をカートへ入れて申し込み</div><p>買取一覧にある商品は、そのままカートへ追加して申込手続きをしてください。<br>一覧に見当たらない商品は、<strong>「まとめて買取」</strong>をカートに入れてお申し込みください。</p></div>
        <div class="flow-step"><div class="flow-title">STEP 2｜受付完了メール確認後に発送</div><p>お申し込み内容の確認が完了すると、受付（承認）メールをお送りします。<br>メールを確認してから商品を発送してください。</p></div>
        <div class="flow-step"><div class="flow-title">STEP 3｜査定結果の確認・承諾</div><p>商品到着後に査定を行い、結果を取引ページのメッセージでご案内します。<br>内容をご確認のうえ、取引画面から承諾／キャンセルのお手続きを行ってください。<br><small>※すべて満額査定の場合は、承諾操作が不要となる場合があります。</small></p></div>
        <hr style="border-color:#444; margin:30px 0;">
        <h3>よくある質問（FAQ）</h3>
        <div class="faq-item"><div class="faq-q">Q. 査定と入金までどれくらい？</div><div class="faq-a">A. 商品到着後、原則として当日中に査定と振込処理を行います。</div></div>
        <div class="faq-item"><div class="faq-q">Q. 送料は必要？</div><div class="faq-a">A. 発送時の送料はお客様負担となります。</div></div>
        <div class="faq-item"><div class="faq-q">Q. 申込書や身分証の印刷・同梱は必要？</div><div class="faq-a">A. 不要です。案内に沿って、身分証はアップロードで提出できます。</div></div>
        <div class="faq-item"><div class="faq-q">Q. 一覧にない商品も申し込める？</div><div class="faq-a">A. 可能です。<strong>「まとめて買取」</strong>をカートに追加して発送してください。到着後にスタッフが査定します。</div></div>
        <div class="faq-item"><div class="faq-q">Q. 申し込み後の連絡はどうする？</div><div class="faq-a">A. 取引ページ内の<strong>チャット（メッセージ）</strong>でやり取りできます。</div></div>
        <div class="faq-item"><div class="faq-q">Q. 発送後にやっぱりやめたい場合は？</div><div class="faq-a">A. 査定結果に納得できない場合はキャンセル可能です。<br>ただし、申込時の金額から減額がない（満額）場合は、原則キャンセルできません。<br>※返送が発生する場合の送料はお客様負担です。</div></div>
        <div class="faq-item"><div class="faq-q">Q. 査定料や振込手数料はかかる？</div><div class="faq-a">A. <strong>かかりません（無料）</strong>です。</div></div>
        <div class="faq-item"><div class="faq-q">Q. 事前にだいたいの金額を知りたい</div><div class="faq-a">A. 公式LINEで相談できます。写真を送れば、スタッフが仮査定します。</div></div>
        <div class="faq-item"><div class="faq-q">Q. 操作が不安・質問したい</div><div class="faq-a">A. 公式LINEでお問い合わせください。</div></div>
        <div class="note-box"><div class="note-title">ご利用前の注意事項</div><p><strong>発送期限と価格の取り扱い</strong><br>• 承認（受付）連絡が19:00以前：当日発送〜翌日到着まで、申込時の価格を基準に対応<br>• 承認（受付）連絡が19:00以降：翌日発送〜翌々日到着まで、申込時の価格を基準に対応<br>• 遠方地域などで到着に2日以上かかる場合は、さらに+1日を目安に取り扱います</p><p><small>※条件を満たさない場合、到着時点の価格・状態をもとに査定となる場合があります。<br>※「発送」の判定は、コンビニ受付ではなく配送会社の集荷・発送処理が基準です。</small></p><p><strong>価格の変動について</strong><br>掲載価格が途中で変わっても、査定は原則として申込時点の価格を基準に行います。<br>申込後〜到着までの価格変動を理由とした変更依頼はお受けできません。</p><p><strong>査定と承諾のルール</strong><br>• 減額なし対象：基本的に減額はありません（ただし著しい破損など、基準外の場合は減額の可能性あり）<br>• それ以外の商品：査定提示後、商品ごとに承諾／キャンセルを選べます<br>※キャンセル分の返送が必要な場合、返送料はお客様負担です。</p><p><strong>キャンセル・返送</strong><br>申込時の金額と同額（満額）となった商品は、原則キャンセルできません。<br>キャンセルした商品の返送費用はお客様負担です。</p><p><strong>受付（承認）連絡について</strong><br>営業時間外の申込は、営業開始後に順次確認します。<br>案内メールが届くまで時間がかかる場合があります。</p><p><strong>ご利用条件</strong><br>• 未成年の方は保護者同意書が必要です<br>• 再シュリンク品など不正品が確認された場合、以後の利用をお断りすることがあります</p><p><strong>免税購入品について</strong><br>免税で購入した商品は買取できません。依頼品に免税購入品が含まれていないことをご確認ください。</p></div>
      `
    };

    function openInfo(t) {
      el("mainView").style.display="none"; el("cartView").style.display="none"; el("infoView").style.display="block";
      el("infoContent").innerHTML = contentData[t];
      if(drawer.classList.contains("open")) toggleDrawer();
      window.scrollTo(0,0);
    }
    function closeInfo() {
      el("infoView").style.display="none"; el("mainView").style.display="block"; window.scrollTo(0,0);
    }

    // モーダル
    const modal = el("modal");
    const closeModalBtn = el("closeModalBtn");
    el("grid").addEventListener("click", (e) => {
      if(e.target.closest(".cart-actions")) return;
      const card = e.target.closest(".card");
      if (card) {
        const item = CURRENT_ITEMS[card.dataset.index];
        if (item) openModal(item);
      }
    });
    function openModal(item) {
      el("modalImg").style.display = item.imageUrl ? "inline-block" : "none";
      if(item.imageUrl) el("modalImg").src = item.imageUrl;
      el("modalTitle").textContent = item.name;
      el("modalPrice").textContent = yen(item.price);
      el("modalLimit").textContent = "残り: " + item.remaining;
      el("modalTags").innerHTML = `<span class="type-label">【${item.type}】</span>`;
      modal.classList.add("active");
    }
    closeModalBtn.onclick = () => modal.classList.remove("active");
    modal.onclick = (e) => { if(e.target === modal) modal.classList.remove("active"); };

    // 初期化
    updateModeUI(); loadData();
  </script>
</body>
</html>
